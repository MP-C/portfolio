<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ </text></svg>">
    <title>OperaÃ§Ã£o Regresso ğŸ </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { background: #f0f4f8; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .hero { background: linear-gradient(135deg, #003366, #00509d); color: white; padding: 50px 0; text-align: center; border-bottom: 5px solid #ffca28; }
        .avatar-3d { font-size: 4rem; display: block; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.2)); transition: 0.3s; cursor: pointer; user-select: none; }
        .avatar-3d:active { transform: scale(0.9); }
        .card-pessoa { border-radius: 20px; border: none; box-shadow: 0 10px 20px rgba(0,0,0,0.05); transition: 0.3s; }
        .card-pessoa:hover { transform: translateY(-5px); }
        .voto-item { background: white; margin-bottom: 5px; padding: 10px; border-radius: 10px; border-left: 5px solid #00509d; }
        .bubble { background: #e9ecef; padding: 10px; border-radius: 15px; min-height: 60px; display: flex; align-items: center; justify-content: center; font-style: italic; }
        
        /* Estilo Contagem Decrescente */
        .countdown-section { background: #fff; border-radius: 20px; padding: 30px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); border: 2px solid #00509d; }
        #timer { font-size: 2rem; font-weight: bold; color: #00509d; }
        .winner-box { display: none; background: #ffca28; color: #003366; padding: 20px; border-radius: 15px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div class="hero mb-5">
    <h1>ğŸ“ OperaÃ§Ã£o Regresso 2026</h1>
    <p class="lead">Clica nas nossas caras para veres o nosso estado de espirito!</p>
</div>

<div class="container">
    <div class="row text-center mb-5">
        <div class="col-md-4 mb-3">
            <div class="card card-pessoa p-4 h-100">
                <span class="avatar-3d" onclick="mudarFrase('mario')">ğŸ§”ğŸ»â€â™‚ï¸</span>
                <h3 class="mt-3">MÃ¡rio</h3>
                <div class="bubble mb-3">
                    <p id="frase-mario" class="small m-0">"JÃ¡ estou a embalar a cave."</p>
                </div>
                <div class="badge bg-primary">0.05% Pronto</div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card card-pessoa p-4 h-100">
                <span class="avatar-3d" onclick="mudarFrase('joana')">ğŸ‘©ğŸ»</span>
                <h3 class="mt-3">Joana</h3>
                <div class="bubble mb-3">
                    <p id="frase-joana" class="small m-0">"A controlar a minha logÃ­stica e a ansiedade dos outros."</p>
                </div>
                <div class="badge bg-danger">Mala a 15%</div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card card-pessoa p-4 h-100">
                <span class="avatar-3d" onclick="mudarFrase('lourenco')">ğŸ‘¶ğŸ»</span>
                <h3 class="mt-3">LourenÃ§o</h3>
                <div class="bubble mb-3">
                    <p id="frase-lourenco" class="small m-0">"SÃ³ quero saber se hÃ¡ espaÃ§o para os brinquedos."</p>
                </div>
                <div class="badge bg-success">SÃ³ quer mimos</div>
            </div>
        </div>
    </div>

    <div class="row mb-5">
        <div class="col-md-6 mb-4">
            <div class="p-4 bg-white shadow rounded-4">
                <div class="alert alert-warning text-center fw-bold mb-4" style="border-radius: 15px; border: 2px dashed #ffca28;">
                    ğŸğŸ¾ğŸ½ï¸ Quem acertar no dia da nossa volta ganha um jantar de luxo! ğŸ•ğŸ¥£ğŸ¹
                </div>
                
                <h4>ğŸ“… Quando Ã© que chegamos?</h4>
                <p class="small text-muted">Vota no dia de 2026 que achas que vamos aterrar.</p>
                <input type="text" id="nome" class="form-control mb-2" placeholder="Teu Nome">
                <input type="date" id="data" class="form-control mb-3" min="2026-01-01" max="2026-12-31">
                <button id="btnVotar" onclick="votar()" class="btn btn-primary w-100 fw-bold">Submeter Aposta!</button>
            </div>
        </div>

        <div class="col-md-6">
            <div class="p-4 bg-light border rounded-4 h-100">
                <h4>ğŸ“Š Quem jÃ¡ apostou:</h4>
                <div id="lista-votos" class="mt-3">
                    <p class="text-muted">A carregar apostas...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-5 justify-content-center">
        <div class="col-md-8 text-center">
            <div class="countdown-section">
                <h4 id="countdown-title">â³ Tempo restante atÃ© saber dos resultados (sem correspondencia com o dia de volta):</h4>
                <div id="timer" class="my-3"></div>
                
                <div id="winner-zone" class="winner-box">
                    <h3>ğŸ† VENCEDOR(A) DO JANTAR ğŸ†</h3>
                    <h2 id="winner-name" class="fw-bold">...</h2>
                    <p class="m-0">ParabÃ©ns! Acertaste na mosca!</p>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center pb-5 opacity-50">
        <p>Â© 2026 OperaÃ§Ã£o Regresso | Desenvolvido com â¤ï¸</p>
    </footer>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbw-sVOkhaqV7rZL-bbOFjedwXXhtu4WreeNTEoX5pwpB9M9QMBCaZt5yekLr7vTyePnuw/exec";
    
    const frases = {
        mario: ["JÃ¡ vou ter de embalar a cave..psss", "Vai ser difÃ­cil dizer 'AtÃ© jÃ¡!'", "O que fazmos a isto? Guarda-se?", "Vou precisar de uma carrinha sÃ³ para os gadgets.", "Quem me ajuda com os servidores?", "Saudades de um pastel de nata!", "Docker pronto para a migraÃ§Ã£o fÃ­sica."],
        joana: ["A controlar a logÃ­stica e a ansiedade.", "Estava difÃ­cil convencer o MÃ¡rio!", "Se nÃ£o usas hÃ¡ mais de um ano, dÃ¡!", "Quantas malas Ã© que o bebÃ© precisa?!", "SÃ³ de pensar na viagem jÃ¡ estou cansada.", "Vou chegar e ir direta para a praia!", "Faltam 3 mil abraÃ§os de despedida."],
        lourenco: ["SÃ³ quero saber dos brinquedos!", "JÃ¡ chegÃ¡mos?", "O aviÃ£o tem Wi-Fi para o Panda?", "Vou andar no colo de muita gente!", "Gugu dada?", "Preparem as bochechas! Vou com tudo e 6 dentes"]
    };

    let indices = { mario: 0, joana: 0, lourenco: 0 };

    function mudarFrase(pessoa) {
        indices[pessoa] = (indices[pessoa] + 1) % frases[pessoa].length;
        document.getElementById(`frase-${pessoa}`).innerText = `"${frases[pessoa][indices[pessoa]]}"`;
    }

    async function votar() {
        const nome = document.getElementById('nome').value.trim();
        const data = document.getElementById('data').value;

        if(!nome || !data) return alert("Preenche tudo!");
        if(localStorage.getItem('ja_votei')) return alert("JÃ¡ votaste! ğŸ˜‰");

        const btn = document.getElementById("btnVotar");
        btn.disabled = true;
        btn.innerText = "A enviar...";

        const urlFinal = SCRIPT_URL + "?nome=" + encodeURIComponent(nome) + "&data=" + encodeURIComponent(data);

        try {
            await fetch(urlFinal, { method: 'GET', mode: 'no-cors' });
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#003366', '#ffca28', '#ffffff'] });

            localStorage.setItem('ja_votei', 'true');
            setTimeout(() => {
                alert("ğŸ‰ REGISTADO! Boa sorte!");
                location.reload();
            }, 1000);
        } catch (e) {
            alert("Erro ao enviar.");
            btn.disabled = false;
        }
    }

    function renderizarVotos() {
        const lista = document.getElementById('lista-votos');
        lista.innerHTML = '<p class="text-muted small">A carregar apostas...</p>';

        // Criamos um pedido "JSONP" que o Google nÃ£o bloqueia
        const script = document.createElement('script');
        // Chamamos o URL com ?callback=processarDados
        script.src = SCRIPT_URL + "?callback=processarDados&t=" + new Date().getTime();
        document.body.appendChild(script);
    }

    // Esta funÃ§Ã£o Ã© chamada automaticamente quando o Google responde
    window.processarDados = function(dados) {
        const lista = document.getElementById('lista-votos');
        
        if (!dados || dados.length === 0) {
            lista.innerHTML = '<p class="text-muted small">Ainda ninguÃ©m arriscou!</p>';
            return;
        }

        // LÃ³gica dos vencedores para o dia 1 de Maio
        const vencedores = dados.filter(v => v[1] && v[1].toString().includes("2026-05-01")).map(v => v[0]);
        window.vencedoresData = vencedores;

        // Ordenar por data
        dados.sort((a, b) => new Date(a[1]) - new Date(b[1]));

        lista.innerHTML = dados.map(v => {
            const d = new Date(v[1]);
            const dataFormatada = !isNaN(d.getTime()) ? d.toLocaleDateString('pt-PT') : v[1];
            return `
                <div class="voto-item">
                    <div class="d-flex justify-content-between align-items-center">
                        <strong>${v[0]}</strong>
                        <span class="badge bg-dark">${dataFormatada}</span>
                    </div>
                </div>
            `;
        }).join('');
    };


    // LÃ³gica da Contagem Decrescente
    function updateCountdown() {
        const targetDate = new Date("June 23, 2026 00:00:00").getTime();
        const now = new Date().getTime();
        const distance = targetDate - now;

        if (distance < 0) {
            document.getElementById("countdown-title").innerHTML = "âœˆï¸ JÃ CHEGÃMOS!";
            document.getElementById("timer").style.display = "none";
            const zone = document.getElementById("winner-zone");
            zone.style.display = "block";
            document.getElementById("winner-name").innerText = window.vencedoresData ? window.vencedoresData.join(", ") : "NinguÃ©m acertou :(";
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        document.getElementById("timer").innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    window.onload = () => {
        renderizarVotos(); // Carrega a lista
        setInterval(updateCountdown, 1000); // Inicia o relÃ³gio
        updateCountdown(); 
    };
</script>
</body>
</html>